<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pt-4">
  <div class="mb-6">
    <h1 class="text-xl font-bold text-gray-900">Webhook Providers</h1>
  </div>

  <% if @providers.any? %>
    <%= render FlatPack::Table::Component.new(rows: @providers) do |table| %>
      <% table.with_column(label: "Name", attribute: :name) %>
      <% table.with_column(
        label: "Display Name",
        formatter: ->(provider) {
          provider_config = CaptainHook.configuration.provider(provider.name)
          provider_config&.display_name || provider.name.titleize
        }
      ) %>
      <% table.with_column(
        label: "Status",
        formatter: ->(provider) {
          db_provider = @db_providers[provider.name]
          if db_provider&.active?
            '<span class="text-green-600 font-medium">Active</span>'.html_safe
          else
            '<span class="text-gray-500">Inactive</span>'.html_safe
          end
        }
      ) %>
      <% table.with_column(
        label: "Security",
        formatter: ->(provider) {
          provider_config = CaptainHook.configuration.provider(provider.name)
          if provider_config&.verifier_class.present?
            '<span class="text-green-600 font-medium">Enabled</span>'.html_safe
          else
            '<span class="text-gray-500">None</span>'.html_safe
          end
        }
      ) %>
      <% table.with_column(
        label: "Actions",
        formatter: ->(provider) {
          db_provider = @db_providers[provider.name]
          if db_provider
            link_to(db_provider.actions.count, admin_provider_actions_path(db_provider))
          else
            "0"
          end
        }
      ) %>
      <% table.with_column(
        label: "Operations",
        formatter: ->(provider) {
          db_provider = @db_providers[provider.name]
          if db_provider
            render(FlatPack::Button::Component.new(
              text: "View",
              url: url_for([:admin, db_provider]),
              style: :secondary,
              size: :sm
            ))
          else
            content_tag(:span, "Not in DB", class: "text-muted")
          end
        }
      ) %>
            content_tag(:span, "Not in DB", class: "text-muted")
          end
        }
      ) %>
    <% end %>
  <% else %>
    <div class="alert alert-info">
      <p class="mb-2"><strong>No providers configured yet.</strong></p>
      <p class="mb-0">Providers are automatically discovered from YAML files in the <code>captain_hook/&lt;provider&gt;/&lt;provider&gt;.yml</code> directory on application boot. Create a provider YAML file and restart the server to add providers.</p>
    </div>
  <% end %>
</div>
