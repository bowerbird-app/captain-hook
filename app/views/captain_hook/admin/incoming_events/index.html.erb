<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <h1 class="text-3xl font-bold text-gray-900 mb-6">Incoming Webhook Events</h1>

  <!-- Filters -->
  <div class="bg-white shadow rounded-lg mb-6">
    <div class="px-6 py-6">
      <%= form_with url: captain_hook.admin_incoming_events_path, method: :get, local: true do |f| %>
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
          <div>
            <%= render FlatPack::TextInput::Component.new(
              name: "provider",
              label: "Provider",
              placeholder: "Provider",
              value: params[:provider]
            ) %>
          </div>
          <div>
            <%= render FlatPack::TextInput::Component.new(
              name: "event_type",
              label: "Event Type",
              placeholder: "Event Type",
              value: params[:event_type]
            ) %>
          </div>
          <div>
            <%= render FlatPack::Select::Component.new(
              name: "status",
              label: "Status",
              options: [
                ['All', ''],
                ['Received', 'received'],
                ['Processing', 'processing'],
                ['Processed', 'processed'],
                ['Partially Processed', 'partially_processed'],
                ['Failed', 'failed']
              ],
              value: params[:status]
            ) %>
          </div>
          <div class="flex items-end gap-2">
            <%= f.submit "Filter", class: "px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-md transition-colors cursor-pointer" %>
            <%= render FlatPack::Button::Component.new(
              text: "Clear",
              url: captain_hook.admin_incoming_events_path,
              style: :secondary
            ) %>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Events Table -->
  <div class="bg-white shadow rounded-lg">
    <div class="px-6 py-6">
      <% if @events.any? %>
        <%= render FlatPack::Table::Component.new(data: @events) do |table| %>
          <% table.column(
            title: "Provider",
            html: ->(event) {
              render(FlatPack::Badge::Component.new(
                text: event.provider,
                style: :info
              ))
            }
          ) %>
          <% table.column(
            title: "Event Type",
            html: ->(event) { "<code class='text-xs bg-gray-100 px-2 py-1 rounded'>#{event.event_type}</code>".html_safe }
          ) %>
          <% table.column(
            title: "External ID",
            html: ->(event) { "<span class='text-sm text-gray-600'>#{event.external_id}</span>".html_safe }
          ) %>
          <% table.column(
            title: "Status",
            html: ->(event) {
              status_style = case event.status&.to_s
              when "received"
                :default
              when "processing"
                :info
              when "processed"
                :success
              when "partially_processed"
                :warning
              when "failed"
                :warning
              else
                :default
              end
              render(FlatPack::Badge::Component.new(
                text: event.status&.titleize&.gsub('_', ' ') || 'N/A',
                style: status_style
              ))
            }
          ) %>
          <% table.column(
            title: "Actions",
            html: ->(event) { event.incoming_event_actions.count.to_s }
          ) %>
          <% table.column(
            title: "Received At",
            html: ->(event) { "#{time_ago_in_words(event.created_at)} ago" }
          ) %>
          <% table.with_action(
            text: "View",
            url: ->(event) { captain_hook.admin_incoming_event_path(event) },
            style: :secondary,
            size: :sm
          ) %>
        <% end %>

        <!-- Pagination -->
        <div class="mt-6">
          <%= paginate @events %>
        </div>
      <% else %>
        <div class="bg-blue-50 border border-blue-200 rounded-lg px-6 py-4">
          <p class="text-blue-800">
            No incoming events found. Events will appear here once webhooks are received.
          </p>
        </div>
      <% end %>
    </div>
  </div>
</div>
