<div class="max-w-6xl mx-auto px-6 py-12">
  <!-- Header -->
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-[var(--ma-color-text)] mb-3">
      ğŸ”— Test Webhook Connection
    </h1>
    <p class="text-base text-[var(--ma-color-muted)]">
      Verify that CaptainHook can receive webhooks from your providers. This tool simulates incoming webhooks to test your configuration and connectivity.
    </p>
  </div>

  <!-- Flash Messages -->
  <% if flash[:notice] %>
    <div class="mb-6 bg-green-50 border border-green-200 dark:bg-green-900/20 dark:border-green-800 rounded-[var(--ma-radius-lg)] p-4">
      <p class="text-sm text-green-800 dark:text-green-200">
        âœ“ <%= flash[:notice] %>
      </p>
    </div>
  <% end %>

  <% if flash[:alert] %>
    <div class="mb-6 bg-red-50 border border-red-200 dark:bg-red-900/20 dark:border-red-800 rounded-[var(--ma-radius-lg)] p-4">
      <p class="text-sm text-red-800 dark:text-red-200">
        âœ— <%= flash[:alert] %>
      </p>
    </div>
  <% end %>

  <!-- Test Configuration Info -->
  <div class="mb-6 bg-[var(--ma-color-bg)] border border-gray-200 dark:border-gray-700 rounded-[var(--ma-radius-lg)] shadow-[var(--ma-shadow-card)] overflow-hidden">
    <div class="p-6">
      <h2 class="text-lg font-semibold text-[var(--ma-color-text)] mb-4">
        ğŸ“‹ Testing Configuration
      </h2>
      <div class="space-y-2.5 text-sm text-[var(--ma-color-text)]">
        <div class="flex items-start">
          <span class="font-medium w-40">Test Provider URL:</span>
          <code class="px-2 py-0.5 bg-[var(--ma-color-bg-soft)] text-[var(--ma-color-accent)] rounded-[var(--ma-radius-sm)] text-xs font-mono flex-1">
            <%= webhook_site_url %>
          </code>
        </div>
        <div class="flex items-start">
          <span class="font-medium w-40">Token:</span>
          <code class="px-2 py-0.5 bg-[var(--ma-color-bg-soft)] text-[var(--ma-color-accent)] rounded-[var(--ma-radius-sm)] text-xs font-mono flex-1">
            <%= webhook_site_token %>
          </code>
        </div>
      </div>
      <p class="text-xs text-[var(--ma-color-muted)] mt-4">
        ğŸ’¡ Note: Configure providers in the admin panel before testing in production.
      </p>
    </div>
  </div>

  <!-- Testing Card -->
  <div class="bg-[var(--ma-color-bg)] border border-gray-200 dark:border-gray-700 rounded-[var(--ma-radius-lg)] shadow-[var(--ma-shadow-card)] overflow-hidden">
    <div class="p-6">
      <h2 class="text-lg font-semibold text-[var(--ma-color-text)] mb-3">
        ğŸ“¥ Test Webhook Connection
      </h2>
      <p class="text-sm text-[var(--ma-color-muted)] mb-4">
        Send a test webhook to verify that CaptainHook can successfully receive and process webhooks from your provider.
      </p>
      
      <%= form_with url: send_incoming_webhook_tester_path, method: :post, local: true, class: "space-y-4" do |f| %>
        <div>
          <%= f.label :provider, "Provider", class: "block text-sm font-medium text-[var(--ma-color-text)] mb-1" %>
          <%= f.select :provider, 
              options_for_select([
                ["Webhook.site", "webhook_site"]
              ], "webhook_site"),
              {},
              class: "w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-[var(--ma-radius-md)] bg-[var(--ma-color-bg)] text-[var(--ma-color-text)] focus:outline-none focus:ring-2 focus:ring-[var(--ma-color-accent)]" %>
        </div>

        <div>
          <%= f.label :token, "Token", class: "block text-sm font-medium text-[var(--ma-color-text)] mb-1" %>
          <%= f.text_field :token, 
              placeholder: "Authentication token", 
              value: webhook_site_token,
              class: "w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-[var(--ma-radius-md)] bg-[var(--ma-color-bg)] text-[var(--ma-color-text)] focus:outline-none focus:ring-2 focus:ring-[var(--ma-color-accent)]" %>
        </div>

        <div>
          <%= f.label :payload, "JSON Payload", class: "block text-sm font-medium text-[var(--ma-color-text)] mb-1" %>
          <%= f.text_area :payload, 
              placeholder: '{"event": "test", "data": {"key": "value"}}', 
              rows: 8,
              value: '{"event": "test.created", "timestamp": "' + Time.now.iso8601 + '", "data": {"id": "123", "status": "success"}}',
              class: "w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-[var(--ma-radius-md)] bg-[var(--ma-color-bg)] text-[var(--ma-color-text)] font-mono text-xs focus:outline-none focus:ring-2 focus:ring-[var(--ma-color-accent)]" %>
        </div>

        <div class="pt-2">
          <%= f.submit "Test Webhook Connection", class: "w-full inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-white bg-[var(--ma-color-brand)] rounded-[var(--ma-radius-md)] hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[var(--ma-color-brand)] transition-opacity cursor-pointer" %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- How it Works -->
  <div class="mt-6 bg-[var(--ma-color-bg)] border border-gray-200 dark:border-gray-700 rounded-[var(--ma-radius-lg)] shadow-[var(--ma-shadow-card)] overflow-hidden">
    <div class="p-6">
      <h2 class="text-lg font-semibold text-[var(--ma-color-text)] mb-4">
        ğŸ” How This Works
      </h2>
      <ol class="space-y-2 text-sm text-[var(--ma-color-text)] list-decimal list-inside">
        <li>This tool sends a test webhook to CaptainHook's incoming webhook endpoint</li>
        <li>CaptainHook validates the request, checks rate limits, and verifies signatures</li>
        <li>If successful, the webhook is processed and you'll see a success message</li>
        <li>You can view the received webhook in the <%= link_to "Incoming Events", "/captain_hook/admin/incoming_events", class: "text-[var(--ma-color-accent)] hover:underline" %> admin</li>
      </ol>
    </div>
  </div>

  <!-- Quick Links -->
  <div class="mt-6 bg-[var(--ma-color-bg)] border border-gray-200 dark:border-gray-700 rounded-[var(--ma-radius-lg)] shadow-[var(--ma-shadow-card)] overflow-hidden">
    <div class="p-6">
      <h2 class="text-lg font-semibold text-[var(--ma-color-text)] mb-4">
        ğŸ”— Quick Links
      </h2>
      <div class="grid gap-3 md:grid-cols-3">
        <a href="/captain_hook" class="inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-[var(--ma-color-text)] bg-[var(--ma-color-bg-soft)] border border-gray-200 dark:border-gray-700 rounded-[var(--ma-radius-md)] hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
          CaptainHook Admin â†’
        </a>
        <a href="/captain_hook/admin/providers" class="inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-[var(--ma-color-text)] bg-[var(--ma-color-bg-soft)] border border-gray-200 dark:border-gray-700 rounded-[var(--ma-radius-md)] hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
          Manage Providers â†’
        </a>
        <a href="<%= webhook_site_url %>" target="_blank" class="inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-[var(--ma-color-text)] bg-[var(--ma-color-bg-soft)] border border-gray-200 dark:border-gray-700 rounded-[var(--ma-radius-md)] hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
          Test Provider Dashboard â†’
        </a>
      </div>
    </div>
  </div>
</div>
